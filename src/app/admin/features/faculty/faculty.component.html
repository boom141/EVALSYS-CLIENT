<main>
  <div class="flex flex-col space-y-8 p-5">
    <div class="flex flex-col">
      <h1 class="text-3xl font-semibold overflow-hidden">Faculty</h1>
      <p class="text-sm">Manage faculty, add members, and view evaluations.</p>
    </div>

    @if(selected_faculty === null){
    <div class="flex flex-col space-y-5 justify-between items-center w-full">
      <div class="w-full">
        <div class="shadow-md w-[500px] bg-white flex items-center mb-3">
          <input
            (input)="onGlobalFilterChange($event)"
            class="px-3 py-2 outline-none text-sm w-full"
            type="text"
            placeholder="Search keyword"
          />
          <div class="px-3 py-2">
            <i class="pi pi-search"></i>
          </div>
        </div>
      </div>

      <div class="w-full bg-white shadow-md mb-3">
        <div class="w-full">
          <p-table
            [value]="pagedData"
            dataKey="_id"
            [rows]="rows"
            [scrollable]="true"
            [scrollHeight]="'320px'"
            class="w-full max-w-screen-lg text-sm text-primary"
          >
            <ng-template #header>
              <tr class="text-left text-xs md:text-sm">
                <th class="w-[5rem] !bg-slate-300"></th>
                <th class="p-5 !bg-slate-300">Department</th>
                <th class="p-5 !bg-slate-300">Evaluation Rating</th>
                <th class="p-5 !bg-slate-300">Feedback Rating</th>
                <th class="p-5 !bg-slate-300">Responses</th>
              </tr>
            </ng-template>

            <ng-template #body let-rowData let-expanded="expanded">
              <tr class="hover:!bg-slate-100 cursor-pointer">
                <td>
                  <p-button
                    type="button"
                    pRipple
                    [pRowToggler]="rowData"
                    [text]="true"
                    severity="secondary"
                    [icon]="
                      expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'
                    "
                  />
                </td>
                <td>{{ rowData.dapartment_name }}</td>
                <td>{{ rowData.evaluation_rating }}% / 100%</td>
                <td>{{ rowData.feedback_rating }}% / 100%</td>
                <td class="w-36">({{ rowData.total_response }}) response</td>
              </tr>
            </ng-template>
            <ng-template #expandedrow let-rowData>
              <tr>
                <td colspan="5">
                  <div class="p-5 flex flex-col space-y-5">
                    <span class="text-xl text-[#282828]">{{ rowData.dapartment_name }} Faculty Members</span>
                    <p-table
                      [value]="rowData.department_data"
                      dataKey="_id"
                      [rows]="rows"
                      [scrollable]="true"
                      [scrollHeight]="'320px'"
                      class="w-full  text-sm text-primary"
                    >
                      <ng-template #header>
                        <tr class="text-left text-xs md:text-sm">
                          <th class="p-5 !bg-slate-300">Name</th>
                          <th class="p-5 !bg-slate-300">Evaluation Rating</th>
                          <th class="p-5 !bg-slate-300">Feedback Rating</th>
                          <th class="p-5 !bg-slate-300">Responses</th>
                          <th class="p-5 !bg-slate-300"></th>
                        </tr>
                      </ng-template>
  
                      <ng-template #body let-subRowData>
                        <tr
                          (click)="select_faculty(subRowData)"
                          class="hover:!bg-slate-100 cursor-pointer"
                        >
                          <td>{{ subRowData.name }}</td>
                          <td>{{ subRowData.overall_data.evaluation_rating }}% / 100%</td>
                          <td>{{ subRowData.overall_data.feedback_rating }}% / 100%</td>
                          <td class="w-36">
                            ({{ subRowData.overall_data.total_response }}) response
                          </td>
                          <td>
                            <div class="flex justify-center items-center">
                              <i class="pi pi-chevron-right"></i>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
        <div class="w-full">
          <p-paginator
            (onPageChange)="onPageChange($event)"
            [first]="first"
            [rows]="rows"
            [totalRecords]="total_records"
            class="text-xs md:text-sm rounded-none mt-2"
          ></p-paginator>
        </div>
      </div>
    </div>
    }@else{
    <div class="flex flex-col space-y-8 mt-5">
      <div class="flex items-center gap-3 text-sm">
        <div
          (click)="back_to_faculty()"
          class="flex items-center px-3 py-2 cursor-pointer group"
        >
          <i class="pi pi-angle-left"></i>
          <span class="group-hover:underline transition-all">Back</span>
        </div>
        <h1 class="text-2xl overflow-hidden">
          {{ selected_faculty_name }}â€™s Overview
        </h1>
      </div>

      <div class="flex flex-row space-x-5 w-full">
        <p-card class="w-full flex flex-col shadow-md !rounded-none mb-3">
          <span class="text-4xl font-bold text-primary">{{
            infocards_data.outstanding.count
          }}</span>

          <div class="mt-2">
            <p class="text-sm font-medium text-primary">
              {{ infocards_data.outstanding.label }}
            </p>
          </div>
        </p-card>
        <p-card class="w-full flex flex-col shadow-md !rounded-none mb-3">
          <span class="text-4xl font-bold text-primary">{{
            infocards_data.agree.count
          }}</span>

          <div class="mt-2">
            <p class="text-sm font-medium text-primary">
              {{ infocards_data.agree.label }}
            </p>
          </div>
        </p-card>
        <p-card class="w-full flex flex-col shadow-md !rounded-none mb-3">
          <span class="text-4xl font-bold text-primary">{{
            infocards_data.neutral.count
          }}</span>

          <div class="mt-2">
            <p class="text-sm font-medium text-primary">
              {{ infocards_data.neutral.label }}
            </p>
          </div>
        </p-card>
        <p-card class="w-full flex flex-col shadow-md !rounded-none mb-3">
          <span class="text-4xl font-bold text-primary">{{
            infocards_data.disagree.count
          }}</span>

          <div class="mt-2">
            <p class="text-sm font-medium text-primary">
              {{ infocards_data.disagree.label }}
            </p>
          </div>
        </p-card>
        <p-card class="w-full flex flex-col shadow-md !rounded-none mb-3">
          <span class="text-4xl font-bold text-primary">{{
            infocards_data.strongly_disagree.count
          }}</span>

          <div class="mt-2">
            <p class="text-sm font-medium text-primary">
              {{ infocards_data.strongly_disagree.label }}
            </p>
          </div>
        </p-card>
      </div>
      <div class="flex flex-row justify-between gap-3">
        <div class="shadow-md w-full p-3 bg-white mb-3">
          <h1 class="text-base">Sentiment Polarity Count</h1>
          <div class="m-5 max-h-[300px]" id="sentiments_barchart"></div>
        </div>
        <div class="shadow-md w-full p-3 bg-white max-w-[500px] mb-3">
          <h1 class="text-base">Students Participation Score</h1>
          <div class="m-5 max-h-[300px]" id="participation_score"></div>
        </div>
      </div>
      <div class="flex flex-row justify-between gap-3">
        <div class="shadow-md w-full p-3 bg-white mb-3">
          <h1 class="text-base font-medium">Positve Polarity Feedbacks</h1>
          <div class="mt-5 overflow-auto overflow-x-hidden max-h-[400px]">
            @for(data of postive_sentiments_data; track $index){
            <div class="flex flex-col p-3 border-l-2 border-[#43900C] mt-3">
              <p class="w-[250px] text-sm italic">"{{ data.message }}"</p>
              <div class="flex w-full justify-between mt-5">
                <span class="text-sm text-slate-400">Anonymous</span>
                <span class="text-sm text-slate-400">{{ data.timestamp }}</span>
              </div>
            </div>
            }
          </div>
        </div>
        <div class="shadow-md w-full p-3 bg-white mb-3">
          <h1 class="text-base font-medium">Neutral Polarity Feedbacks</h1>
          <div class="mt-5 overflow-auto overflow-x-hidden max-h-[500px] mt-3">
            @for(data of neutral_sentiments_data; track $index){
            <div class="flex flex-col p-3 border-l-2 border-[#CECECE] mt-3">
              <p class="w-[250px] text-sm italic">"{{ data.message }}"</p>
              <div class="flex w-full justify-between mt-5">
                <span class="text-sm text-slate-400">Anonymous</span>
                <span class="text-sm text-slate-400">{{ data.timestamp }}</span>
              </div>
            </div>
            }
          </div>
        </div>
        <div class="shadow-md w-full p-3 bg-white mb-3">
          <h1 class="text-base font-medium">Negative Polarity Feedbacks</h1>
          <div class="mt-5 overflow-auto overflow-x-hidden max-h-[500px]">
            @for(data of negative_sentiments_data; track $index){
            <div class="flex flex-col p-3 border-l-2 border-[#DD1111] mt-3">
              <p class="w-[250px] text-sm italic">"{{ data.message }}"</p>
              <div class="flex w-full justify-between mt-5">
                <span class="text-sm text-slate-400">Anonymous</span>
                <span class="text-sm text-slate-400">{{ data.timestamp }}</span>
              </div>
            </div>
            }
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</main>
